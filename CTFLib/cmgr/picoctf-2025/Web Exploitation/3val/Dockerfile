# Use Python slim image
FROM ubuntu:20.04

# Set environment variables
ENV PORT=5000

# Update and install necessary packages
RUN apt-get update && \
    apt-get install -y python3 python3-pip && \
    pip3 install flask

# Create a non-root user
RUN groupadd -r app && useradd -r -d /app -g app app

# Create the working directory and set it
RUN mkdir -p /app
RUN mkdir -p /challenge
COPY app.py /challenge/app.py
COPY flag.py /challenge/flag.py
RUN chmod +x /challenge/flag.py
ARG FLAG
ARG SEED


WORKDIR /app

# Copy the application file(s) into the container
COPY app.py /app/app.py
COPY static /app/static
COPY templates /app/templates
RUN python3 /challenge/flag.py
RUN chmod 000 /challenge/metadata.json
# Change ownership to the non-root user
RUN chown -R app:app /app

# Switch to the non-root user
USER app

# Expose the port on which the Flask app will run
EXPOSE 5000


# PUBLISH 5000 AS HTTP

# Run the Flask application
CMD ["python3", "app.py"]