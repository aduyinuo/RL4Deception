FROM trafex/php-nginx@sha256:f6161967aefcaf52f7a81d1972a62b12fb2510ad569125e4120a5f9a500492c8

USER root
RUN apk update && apk add --no-cache php82-sqlite3 python3

COPY index.php admin.php login.php secure.js style.css /var/www/html/

ARG FLAG
ARG SEED

RUN install -d -m 0700 /challenge/
COPY byteblast.py setup-challenge.py /challenge/
WORKDIR /challenge/
RUN python3 setup-challenge.py

WORKDIR /var/www/html/
USER nobody

EXPOSE 8080
# PUBLISH 8080 AS http