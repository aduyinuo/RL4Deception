from hacksport.problem import files_from_directory, PHPApp, ProtectedFile
import sqlite3


class Problem(PHPApp):
	files = files_from_directory("webroot/") + [ProtectedFile("users.db")]
	php_root = "webroot/"
	num_workers = 5
	username = "admin"
	roundpass = "aTotallyNonguessablepassword2"

	def setup(self):
		conn = sqlite3.connect("users.db")
		c = conn.cursor()
		c.execute("CREATE TABLE users (username text, password text);")
		c.execute("INSERT INTO users VALUES (?, ?)", (self.username, self.roundpass))
		c.execute("INSERT INTO users VALUES (\"guest\", \"arandompassword\")")
		c.execute("INSERT INTO users VALUES (\"someuser\", \"redherring\")")
		conn.commit()
		conn.close()

	def generate_flag(self, random):
		hexdigits = "{:08x}".format(random.randrange(16**32))
		return	"picoCTF{0n3_m0r3_t1m3_%s}" % hexdigits
